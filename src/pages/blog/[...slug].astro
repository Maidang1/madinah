---
import { getCollection, render } from "astro:content";
import { components } from "../../components/mdx";
import BaseLayout from "../../layouts/BaseLayout.astro";
import LicenseNotice from "../../components/LicenseNotice.astro";
import Time from "../../components/Time.astro";
import { calculateReadingTime } from "../../utils/reading-time";

export async function getStaticPaths() {
    const posts = await getCollection("blog");
    return posts.map((post) => ({
        params: { slug: post.id },
        props: { post },
    }));
}

const { post } = Astro.props;
const { Content } = await render(post);
const readingTime = calculateReadingTime(post.body);
---

<BaseLayout title={`${post.data.title} - Madinah's Blog`} description={post.data.description}>
  <article class="mx-auto w-full max-w-3xl">
    <!-- Article Header -->
    <header class="mb-10 space-y-6 border-b border-border-default pb-6">
      <h1 class="text-text-primary text-left text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl leading-tight">
        {post.data.title}
      </h1>
      
      <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-text-secondary font-mono">
        <div class="flex items-center gap-2">
          <span>Date:</span>
          <Time time={post.data.pubDate} />
        </div>
        
        <span class="text-text-muted">|</span>
        
        <div>
          Estimated Reading Time: {readingTime.minutes} min
        </div>

        {post.data.author && (
          <>
            <span class="text-text-muted">|</span>
            <div>Author: {post.data.author}</div>
          </>
        )}
      </div>
    </header>

    <!-- Article Content -->
    <div class="mdx-content mt-8">
      <Content components={components} />
    </div>

    <!-- License Notice -->
    <LicenseNotice />
  </article>
</BaseLayout>
