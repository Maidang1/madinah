import{j as s}from"./index-BZchTVqk.js";import{u as c}from"./index-CFAftGZl.js";function n(e){const l={a:"a",code:"code",div:"div",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...c(),...e.components};return s.jsxs(s.Fragment,{children:[s.jsxs(l.h2,{id:"名次解释",children:["名次解释",s.jsx(l.a,{className:"header-anchor",href:"#名次解释",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsxs(l.ul,{children:[`
`,s.jsxs(l.li,{children:[s.jsx(l.strong,{children:"trait"}),": 是一种定义共享行为的方式，它类似于其他编程语言中的接口（interface）或抽象类（abstract class）。trait 允许你定义一组方法，这些方法可以被任何类型的结构体、枚举或实现该 trait 的类型所使用"]}),`
`]}),`
`,s.jsxs(l.h2,{id:"rust-异步编程",children:["Rust 异步编程",s.jsx(l.a,{className:"header-anchor",href:"#rust-异步编程",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsxs(l.p,{children:["异步编程，或者叫异步，是一种被越来越多编程语言支持的并发编程模型。它能够在一小撮 OS 线程上运行一大堆并发任务，同时还能通过 ",s.jsx(l.code,{children:"async/await"})," 语法，保持原本同步编程的观感。"]}),`
`,s.jsx(l.p,{children:"在 Rust 中主要应用的是 进程—线程—协程 异步模型，如下所示："}),`
`,s.jsx(l.p,{children:s.jsx(l.img,{src:"https://images.felixwliu.cn/async-model.png",alt:"异步编程"})}),`
`,s.jsx(l.p,{children:"下层是进程，进程是持有资源的最小单位；中层是线程，线程不持有资源，是 CPU 调度的最小单位；上层是协程，协程既不持有资源、也不在意 CPU 的调度，它仅仅关注的是“协作式的、自然的流程切换”。"}),`
`,s.jsx(l.p,{children:"异步运行时就负责调度执行上述的协程对象。例如在一个协程在等待 IO 时，这个协程会主动出让自己的执行权给异步运行时，这时异步运行时可以调度运行其他的协程，从而最大化地利用 CPU 时间片。在 IO 密集型的应用中，异步编程将能够极大地提高执行效率"}),`
`,s.jsxs(l.h2,{id:"asyncawait-的使用",children:["async/await 的使用",s.jsx(l.a,{className:"header-anchor",href:"#asyncawait-的使用",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsxs(l.p,{children:[s.jsx(l.code,{children:"async/await"})," 是 Rust 中特殊的语法，它使得让出当前线程的控制权而不阻塞线程成为可能，从而允许在等待一个操作完成时可以运行其他代码。"]}),`
`,s.jsx(l.p,{children:s.jsx(l.strong,{children:"简单代码"})}),`
`,s.jsxs(l.pre,{className:"shiki dark-plus",style:{backgroundColor:"#1E1E1E",color:"#D4D4D4"},children:[s.jsx(l.div,{className:"language-id",children:"rust"}),s.jsx(l.div,{className:"code-container",children:s.jsxs(l.code,{children:[s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"use"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"tokio"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"time"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::{sleep, "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Duration"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"};"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"foo"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"() -> "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"u8"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"sleep"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Duration"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"from_secs"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"1"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"))."}),s.jsx(l.span,{style:{color:"#C586C0"},children:"await"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:";"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"5"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"// 另一个异步函数，调用 `foo` 并等待其结果"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"bar"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"() -> "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"u8"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"result"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"foo"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"()."}),s.jsx(l.span,{style:{color:"#C586C0"},children:"await"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:";"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"result"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" + "}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"1"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})}),s.jsx(l.div,{className:"line"}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"#[tokio::main]"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"main"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"() {"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"    // 调用 `bar` 并等待其结果"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"result"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"bar"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"()."}),s.jsx(l.span,{style:{color:"#C586C0"},children:"await"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:";"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"println!"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#CE9178"},children:'"Result: {}"'}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:", "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"result"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:");"}),s.jsx(l.span,{style:{color:"#6A9955"},children:" // 输出: Result: 6"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})})]})})]}),`
`,s.jsxs(l.p,{children:["有两种主要的方式使用 ",s.jsx(l.code,{children:"async：async fn 和 async {}"}),"。这两中使用方式都会返回一个实现了 ",s.jsx(l.code,{children:"Future trait"})," 的值："]}),`
`,s.jsxs(l.pre,{className:"shiki dark-plus",style:{backgroundColor:"#1E1E1E",color:"#D4D4D4"},children:[s.jsx(l.div,{className:"language-id",children:"rust"}),s.jsx(l.div,{className:"code-container",children:s.jsxs(l.code,{children:[s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"// `foo()` 返回一个实现了 `Future<Output = u8>` 的类型。"})}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"// `foo().await` 将会产生一个 u8 类型的值。"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"foo"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"() -> "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"u8"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" { "}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"5"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" }"})]}),s.jsx(l.div,{className:"line"}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"bar"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"() -> "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"impl"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Future"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Output"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"u8"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"> {"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"    // 这个 `async` 块会产生一个实现了 `Future<Output = u8>` 的类型。"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"x"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:": "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"u8"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"foo"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"()."}),s.jsx(l.span,{style:{color:"#C586C0"},children:"await"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:";"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"x"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" + "}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"5"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    }"})}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})}),s.jsx(l.div,{className:"line"})]})})]}),`
`,s.jsxs(l.p,{children:[s.jsx(l.code,{children:"async fn 和 async {}"})," 返回的 ",s.jsx(l.code,{children:"Future"})," 是惰性的：在真正开始运行之前它什么也不会做。运行一个 ",s.jsx(l.code,{children:"Future"})," 的最普遍的方式是 ",s.jsx(l.code,{children:"await"})," 这个 ",s.jsx(l.code,{children:"Future： Future.await"}),`。
当 `,s.jsx(l.code,{children:"await"})," 一个 ",s.jsx(l.code,{children:"Future"}),` 时，会暂停当前函数的运行，直到完成对 Future 的运行。如果这个 Future 被阻塞住了（例如等待网络 IO），它会让出当前线程的控制权。当 Future 中的阻塞操作就绪时（
例如等待的网络 IO 返回了响应），executor 会通过 `,s.jsx(l.code,{children:"poll"})," 会恢复 ",s.jsx(l.code,{children:"Future"})," 的运行。"]}),`
`,s.jsxs(l.h3,{id:"async-lifetime",children:["async lifetime",s.jsx(l.a,{className:"header-anchor",href:"#async-lifetime",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsxs(l.p,{children:["与普通的函数不一样，",s.jsx(l.code,{children:"async fn"})," 会获取引用或其他非静态生命周期的参数，然后返回被这些参数的生命周期约束的 ",s.jsx(l.code,{children:"Future"}),"："]}),`
`,s.jsxs(l.pre,{className:"shiki dark-plus",style:{backgroundColor:"#1E1E1E",color:"#D4D4D4"},children:[s.jsx(l.div,{className:"language-id",children:"rust"}),s.jsx(l.div,{className:"code-container",children:s.jsxs(l.code,{children:[s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"foo"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"x"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:": &"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"u8"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:") -> "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"u8"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" { *"}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"x"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" }"})]}),s.jsx(l.div,{className:"line"}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"// 这与上面的函数完全等价"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"foo_expanded"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<'"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"a"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:">("}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"x"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:": &'"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"a"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"u8"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:") -> "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"impl"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Future"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Output"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"u8"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"> + '"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"a"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"move"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" { *"}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"x"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" }"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})})]})})]}),`
`,s.jsxs(l.ul,{children:[`
`,s.jsxs(l.li,{children:[s.jsx(l.code,{children:"<'a>"}),"：这是一个生命周期参数，表示引用 x 的生命周期。"]}),`
`,s.jsxs(l.li,{children:["x: ",s.jsx(l.code,{children:"&'a u8"}),"：函数参数 x 是一个生命周期为 'a 的 u8 类型的引用。"]}),`
`,s.jsxs(l.li,{children:[s.jsx(l.code,{children:"-> impl Future<Output = u8> + 'a："}),"函数返回一个实现了 ",s.jsx(l.code,{children:"Future"})," 特性的对象，该对象的输出类型为 ",s.jsx(l.code,{children:"u8"}),"，且具有生命周期 ",s.jsx(l.code,{children:"'a"}),"。"]}),`
`]}),`
`,s.jsxs(l.p,{children:["这意味着，",s.jsx(l.code,{children:"async fn"})," 返回的 ",s.jsx(l.code,{children:"Future "}),"必须在非静态生命周期参数仍然有效时 ",s.jsx(l.code,{children:".await"}),"。在大多数情况下，我们在调用 ",s.jsx(l.code,{children:"async"})," 函数后会立马 ",s.jsx(l.code,{children:".await（例如 foo(&x).await）"}),"，因此 ",s.jsx(l.code,{children:"async lifetime"}),` 不会对执行产生什么影响。
但是，如果我们存储这种 `,s.jsx(l.code,{children:"Futur"}),"e 或者发送给其他的 ",s.jsx(l.code,{children:"task"})," 或者 ",s.jsx(l.code,{children:"thread"}),"，就可能会造成问题。"]}),`
`,s.jsxs(l.p,{children:["把带有引用参数的",s.jsx(l.code,{children:"async fn"})," 转化为静态 ",s.jsx(l.code,{children:"Future"})," 的解决方法是：把参数和对 ",s.jsx(l.code,{children:"async fn"})," 的调用封装到 ",s.jsx(l.code,{children:"async"})," 块中："]}),`
`,s.jsxs(l.pre,{className:"shiki dark-plus",style:{backgroundColor:"#1E1E1E",color:"#D4D4D4"},children:[s.jsx(l.div,{className:"language-id",children:"rust"}),s.jsx(l.div,{className:"code-container",children:s.jsxs(l.code,{children:[s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"bad"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"() -> "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"impl"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Future"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Output"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"u8"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"> {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"x"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"5"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:";"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"borrow_x"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"(&"}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"x"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:")"}),s.jsx(l.span,{style:{color:"#6A9955"},children:" // ERROR: `x` does not live long enough"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})}),s.jsx(l.div,{className:"line"}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"good"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"() -> "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"impl"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Future"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Output"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"u8"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"> {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"x"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"5"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:";"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"borrow_x"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"(&"}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"x"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:")."}),s.jsx(l.span,{style:{color:"#C586C0"},children:"await"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    }"})}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})})]})})]}),`
`,s.jsxs(l.h3,{id:"rust-异步和其他语言的区别",children:["Rust 异步和其他语言的区别",s.jsx(l.a,{className:"header-anchor",href:"#rust-异步和其他语言的区别",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsxs(l.ul,{children:[`
`,s.jsxs(l.li,{children:["Rust 中 ",s.jsx(l.code,{children:"Futures"})," 是惰性的，并且只有被轮询才会进一步执行。丢弃（Dropping）一个 future 可以阻止它继续执行。"]}),`
`,s.jsx(l.li,{children:"Rust 中的 异步是零成本的，这意味着你只需要为你所使用的东西付出代价。特别来说，你使用异步时可以不需要堆分配或动态分发，这对性能来说是好事！这也使得你能够在约束环境下使用异步，例如嵌入式系统。"}),`
`,s.jsx(l.li,{children:"Rust 不提供内置运行时。相反，运行时由社区维护的库提供。"}),`
`,s.jsx(l.li,{children:"Rust 里 单线程的和多线程的 运行时都可用，而他们会有不同的优劣"}),`
`]}),`
`,s.jsxs(l.h2,{id:"future-trait",children:["Future trait",s.jsx(l.a,{className:"header-anchor",href:"#future-trait",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsxs(l.pre,{className:"shiki dark-plus",style:{backgroundColor:"#1E1E1E",color:"#D4D4D4"},children:[s.jsx(l.div,{className:"language-id",children:"rust"}),s.jsx(l.div,{className:"code-container",children:s.jsxs(l.code,{children:[s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"pub"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"trait"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Future"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"type"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Output"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:";"}),s.jsx(l.span,{style:{color:"#6A9955"},children:"	// Future计算完成时产生的值的类型"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"poll"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#569CD6"},children:"self"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:": "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Pin"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<&"}),s.jsx(l.span,{style:{color:"#569CD6"},children:"mut"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"Self"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:">, "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"cx"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:": &"}),s.jsx(l.span,{style:{color:"#569CD6"},children:"mut"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Context"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<'"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"_"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:">) -> "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Poll"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<"}),s.jsx(l.span,{style:{color:"#569CD6"},children:"Self"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Output"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:">;"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})})]})})]}),`
`,s.jsxs(l.p,{children:[s.jsx(l.code,{children:"Future"})," 表示一个异步计算，或者说会在未来完成计算的操作。",s.jsx(l.code,{children:"Future "}),"的核心是 ",s.jsx(l.code,{children:"poll"})," 方法，当调用 ",s.jsx(l.code,{children:"poll"})," 方法时会尝试计算 ",s.jsx(l.code,{children:"Future"}),` 得到最终的值。
如果值还没有准备好（例如等待某些事件发生），则此方法不会阻塞，而是会直接返回一个结果表示 Future 还没有计算完毕`]}),`
`,s.jsxs(l.h3,{id:"poll",children:["Poll",s.jsx(l.a,{className:"header-anchor",href:"#poll",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsxs(l.p,{children:["当调用 ",s.jsx(l.code,{children:"Future"})," 的 ",s.jsx(l.code,{children:"poll"})," 方法时会返回一个枚举类型的值："]}),`
`,s.jsxs(l.ul,{children:[`
`,s.jsxs(l.li,{children:[s.jsx(l.code,{children:"Poll::Pending"}),"，表示这个 ",s.jsx(l.code,{children:"Future"})," 还没计算完成"]}),`
`,s.jsxs(l.li,{children:[s.jsx(l.code,{children:"Poll::Ready(val)"}),"，表示这个 ",s.jsx(l.code,{children:"Future"})," 计算完毕，并附带计算结果：",s.jsx(l.code,{children:"val"})]}),`
`]}),`
`,s.jsxs(l.p,{children:["如果 ",s.jsx(l.code,{children:"Future"})," 没有计算完成，例如想要等待一个 ",s.jsx(l.code,{children:"IO"})," 事件发生，那么在 ",s.jsx(l.code,{children:"poll"})," 方法体内，我们通常会调用传递给 ",s.jsx(l.code,{children:"poll"})," 方法的 ",s.jsx(l.code,{children:"Context"})," 的 ",s.jsx(l.code,{children:"waker"})," 方法拿到一个 ",s.jsx(l.code,{children:"Wake"}),"r（通常把 Waker 叫做唤醒器），然后注册这个 ",s.jsx(l.code,{children:"Waker"})," 到一个“事件通知系统”中，最后返回 ",s.jsx(l.code,{children:"Pending"})," 表示 ",s.jsx(l.code,{children:"Future"})," 没有计算完成。"]}),`
`,s.jsxs(l.p,{children:["在未来某一时刻，",s.jsx(l.code,{children:"Future"})," 等待的 ",s.jsx(l.code,{children:"IO"})," 事件就绪了，那么“事件通知系统”就会利用我们注册的 ",s.jsx(l.code,{children:"Waker"})," 通过某种唤醒机制唤醒这个 ",s.jsx(l.code,{children:"Future"}),"，通过 ",s.jsx(l.code,{children:"poll"})," 继续计算执行该 ",s.jsx(l.code,{children:"Future"}),"。"]}),`
`,s.jsxs(l.p,{children:["通过 ",s.jsx(l.code,{children:"Waker"})," 唤醒器，我们可以只在 ",s.jsx(l.code,{children:"Future"})," 想要等待的事件就绪时，才去唤醒 ",s.jsx(l.code,{children:"Future"}),"。这样我们就不需要通过一个死循环不断的调用 ",s.jsx(l.code,{children:"poll"})," 方法来驱动 ",s.jsx(l.code,{children:"Future"})," 的执行，这是异步编程之所以高效的关键所在。"]}),`
`,s.jsxs(l.pre,{className:"shiki dark-plus",style:{backgroundColor:"#1E1E1E",color:"#D4D4D4"},children:[s.jsx(l.div,{className:"language-id",children:"rust"}),s.jsx(l.div,{className:"code-container",children:s.jsxs(l.code,{children:[s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"struct"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"SocketRead"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<'"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"a"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"> {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"socket"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:": &'"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"a"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Socket"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})}),s.jsx(l.div,{className:"line"}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"impl"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<'"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"a"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"> "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Future"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#C586C0"},children:"for"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"SocketRead"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<'"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"a"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"> {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"type"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Output"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Vec"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"u8"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:">;"})]}),s.jsx(l.div,{className:"line"}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"poll"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#569CD6"},children:"self"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:": "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Pin"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<&"}),s.jsx(l.span,{style:{color:"#569CD6"},children:"mut"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"Self"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:">, "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"cx"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:": &"}),s.jsx(l.span,{style:{color:"#569CD6"},children:"mut"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Context"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<'"}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"_"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"'>) -> "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Poll"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<"}),s.jsx(l.span,{style:{color:"#569CD6"},children:"Self"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Output"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"> {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"data"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"self"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:".socket."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"no_block_read"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::<"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Option"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Vec"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"<"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"u8"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:">>>("}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"1024"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:");"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        "}),s.jsx(l.span,{style:{color:"#C586C0"},children:"match"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"data"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"            "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Some"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"data"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:") => "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Poll"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"Ready"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"data"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"),"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"            "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"None"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" => {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"                REACTOR."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"registe_waker_and_event"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#569CD6"},children:"self"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:".socket, "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Type"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Read"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:", "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"cx"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"waker"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"()."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"clone"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"());"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"                "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Poll"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Pending"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"            }"})}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        }"})}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    }"})}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})})]})})]}),`
`,s.jsxs(l.p,{children:["代码中的 ",s.jsx(l.code,{children:"REACTOR"})," 就是前文中所提到过的“事件通知系统”。当 ",s.jsx(l.code,{children:"socket"})," 中有数据可读时，",s.jsx(l.code,{children:"REACTOR"}),"就会使用注册的 ",s.jsx(l.code,{children:"Wake"}),"r 唤醒负责 ",s.jsx(l.code,{children:"SocketRead"})," ，然后调用 ",s.jsx(l.code,{children:"poll"})," 方法再次计算该 ",s.jsx(l.code,{children:"Future"}),"。"]}),`
`,s.jsxs(l.h2,{id:"rust-异步调试",children:["Rust 异步调试",s.jsx(l.a,{className:"header-anchor",href:"#rust-异步调试",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsxs(l.h3,{id:"编译结果",children:["编译结果",s.jsx(l.a,{className:"header-anchor",href:"#编译结果",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsx(l.p,{children:s.jsx(l.img,{src:"https://images.felixwliu.cn/64211729439988_.pic.jpg",alt:"编译结果"})}),`
`,s.jsx(l.p,{children:"rust 异步实现是一个无栈协程实现，所有的执行都是在工作线程执行的"}),`
`,s.jsxs(l.ul,{children:[`
`,s.jsxs(l.li,{children:[s.jsx(l.code,{children:"Future"}),"执行使用工作线程的栈，无独立栈空间"]}),`
`,s.jsxs(l.li,{children:[s.jsx(l.code,{children:"Poll"}),"函数执行完毕，栈将被回收"]}),`
`]}),`
`,s.jsx(l.p,{children:s.jsx(l.img,{src:"https://images.felixwliu.cn/WX20241021-001108%402x.png",alt:"无栈协程"})}),`
`,s.jsxs(l.p,{children:["执行的时候 工作线程会开栈，保存自己的寄存器和一些上下文的信息，获取异步任务执行的时候，调用 poll 函数，给 poll 函数创建一个栈，保存 ",s.jsx(l.code,{children:"poll"}),`函数里面的
变量和一些上下文信息。当 `,s.jsx(l.code,{children:"poll"}),"函数执行完毕， 无论返回的状态是 ",s.jsx(l.code,{children:"pending"})," 还是 ",s.jsx(l.code,{children:"ready"}),` 栈将被回收 回到之前的执行逻辑上面去。这样就会有严重的缺点， poll 方法执行之后
栈就被回收了，只有在异步执行的过程中，用户才能观察到异步任务的状态。当异步任务挂起的时候，用户无法观察到异步任务的状态，这样就会导致调试困难。`]}),`
`,s.jsx(l.p,{children:s.jsx(l.img,{src:"https://images.felixwliu.cn/debug.png",alt:"定位问题"})}),`
`,s.jsxs(l.h3,{id:"调测工具",children:["调测工具",s.jsx(l.a,{className:"header-anchor",href:"#调测工具",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsxs(l.h4,{id:"tokio-tracing",children:["tokio-tracing",s.jsx(l.a,{className:"header-anchor",href:"#tokio-tracing",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsx(l.p,{children:"tokio-tracing 提供了一种结构化的日志记录方式，可以捕获和记录异步任务的上下文信息"}),`
`,s.jsxs(l.pre,{className:"shiki dark-plus",style:{backgroundColor:"#1E1E1E",color:"#D4D4D4"},children:[s.jsx(l.div,{className:"language-id",children:"rust"}),s.jsx(l.div,{className:"code-container",children:s.jsxs(l.code,{children:[s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"use"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"tracing"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::{info, instrument};"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"use"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"tracing_subscriber"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::{fmt, "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"layer"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"SubscriberExt"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:", "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"util"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"SubscriberInitExt"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"};"})]}),s.jsx(l.div,{className:"line"}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"#[instrument]"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"foo"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"ans"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:": "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"i32"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:") {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"info!"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#CE9178"},children:'"in foo"'}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:");"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})}),s.jsx(l.div,{className:"line"}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"main"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"() {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"tracing_subscriber"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"registry"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"()."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"with"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"fmt"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"layer"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"())."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"init"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"();"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"foo"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"42"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:");"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})})]})})]}),`
`,s.jsx(l.p,{children:"运行结果："}),`
`,s.jsxs(l.pre,{className:"shiki dark-plus",style:{backgroundColor:"#1E1E1E",color:"#D4D4D4"},children:[s.jsx(l.div,{className:"language-id",children:"shell"}),s.jsx(l.div,{className:"code-container",children:s.jsx(l.code,{children:s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"2022-04-10T02:44:12.885556Z  INFO foo{ans=42}: test_tracing: "}),s.jsx(l.span,{style:{color:"#C586C0"},children:"in"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" foo"})]})})})]}),`
`,s.jsxs(l.p,{children:[s.jsx(l.code,{children:"#[instrument]"})," 宏会自动为函数生成跟踪信息，包括函数名和参数。",s.jsx(l.code,{children:"info!"})," 宏用于记录日志信息。"]}),`
`,s.jsxs(l.h4,{id:"tokio-console",children:["tokio-console",s.jsx(l.a,{className:"header-anchor",href:"#tokio-console",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsxs(l.pre,{className:"shiki dark-plus",style:{backgroundColor:"#1E1E1E",color:"#D4D4D4"},children:[s.jsx(l.div,{className:"language-id",children:"rust"}),s.jsx(l.div,{className:"code-container",children:s.jsxs(l.code,{children:[s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"use"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"std"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::{"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"sync"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Arc"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:", "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"time"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Duration"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"};"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"use"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"tokio"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::{"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"sync"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Semaphore"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:", task, "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"time"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::sleep};"})]}),s.jsx(l.div,{className:"line"}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"#[tokio::main]"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"main"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"() {"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"    // 注意. 初始化tracing收集"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"console_subscriber"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"init"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"();"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"    // 线程1的令牌桶1初始一个令牌，可以先打印1"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"semaphore"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Arc"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"new"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Semaphore"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"new"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"1"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"));"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"cnt"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"3"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:";"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"semaphore2"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"semaphore"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"clone"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"();"})]}),s.jsx(l.div,{className:"line"}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"    // 线程2的令牌桶2初始没有令牌，直到1打印后增加令牌"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"semaphore_wait"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Arc"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"new"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Semaphore"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"new"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"0"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"));"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"semaphore_wait2"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"semaphore_wait"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"clone"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"();"})]}),s.jsx(l.div,{className:"line"}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"    // 注意. 使用task::Builder来增加task名字，否则等同tokio::spawn"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"t1"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"task"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Builder"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"default"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"()"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        ."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"name"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#CE9178"},children:'"t1"'}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:")"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        ."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"spawn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"move"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"            "}),s.jsx(l.span,{style:{color:"#C586C0"},children:"for"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"i"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"in"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"0"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:".."}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"cnt"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"                "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"permit"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"semaphore"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"acquire"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"()."}),s.jsx(l.span,{style:{color:"#C586C0"},children:"await"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"unwrap"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"();"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"                "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"print!"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#CE9178"},children:'"1 "'}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:");"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"                // 注意. 增加等待时间，便于观测"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"                "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"sleep"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Duration"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"from_secs"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"i"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"))."}),s.jsx(l.span,{style:{color:"#C586C0"},children:"await"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:";"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"                // 消耗令牌，不放回令牌桶1"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"                "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"permit"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"forget"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"();"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"                // 令牌桶2增加令牌，可以打印2"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"                "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"semaphore_wait2"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"add_permits"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"1"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:");"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"            }"})}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        })"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        ."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"unwrap"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"();"})]}),s.jsx(l.div,{className:"line"}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"t2"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"task"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Builder"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"default"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"()"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        ."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"name"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#CE9178"},children:'"t2"'}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:")"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        ."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"spawn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"move"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"            "}),s.jsx(l.span,{style:{color:"#C586C0"},children:"for"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"i"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"in"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"0"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:".."}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"cnt"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"                "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"permit"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"semaphore_wait"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"acquire"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"()."}),s.jsx(l.span,{style:{color:"#C586C0"},children:"await"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"unwrap"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"();"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"                "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"print!"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#CE9178"},children:'"2 "'}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:");"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"                // 注意. 增加等待时间，便于观测"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"                "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"sleep"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Duration"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"from_secs"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"i"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"))."}),s.jsx(l.span,{style:{color:"#C586C0"},children:"await"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:";"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"                // 消耗令牌，不放回令牌桶2"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"                "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"permit"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"forget"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"();"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"                // 令牌桶1增加令牌，可以打印1"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"                "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"semaphore2"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"add_permits"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"1"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:");"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"            }"})}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        })"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        ."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"unwrap"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"();"})]}),s.jsx(l.div,{className:"line"}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"tokio"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"try_join!"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"t1"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:", "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"t2"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:")."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"unwrap"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"();"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})}),s.jsx(l.div,{className:"line"})]})})]}),`
`,s.jsx(l.p,{children:s.jsx(l.img,{src:"https://images.felixwliu.cn/screenshot-20241021-011452.png",alt:"result"})}),`
`,s.jsxs(l.h4,{id:"await-tree",children:["await-tree",s.jsx(l.a,{className:"header-anchor",href:"#await-tree",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsxs(l.pre,{className:"shiki dark-plus",style:{backgroundColor:"#1E1E1E",color:"#D4D4D4"},children:[s.jsx(l.div,{className:"language-id",children:"rust"}),s.jsx(l.div,{className:"code-container",children:s.jsxs(l.code,{children:[s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"use"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"std"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"time"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Duration"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:";"})]}),s.jsx(l.div,{className:"line"}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"use"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"await_tree"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::{"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Config"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:", "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"InstrumentAwait"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:", "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Registry"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"};"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"use"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"futures"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"future"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::{join, pending};"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"use"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"tokio"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"time"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::sleep;"})]}),s.jsx(l.div,{className:"line"}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"bar"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"i"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:": "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"i32"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:") {"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"    // `&'static str` span"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"baz"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"i"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:")."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"instrument_await"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#CE9178"},children:'"baz in bar"'}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:")."}),s.jsx(l.span,{style:{color:"#C586C0"},children:"await"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})}),s.jsx(l.div,{className:"line"}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"baz"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"i"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:": "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"i32"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:") {"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"    // runtime `String` span is also supported"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"pending"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"()"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        ."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"instrument_await"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"format!"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#CE9178"},children:'"pending in baz {i}"'}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"))"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        ."}),s.jsx(l.span,{style:{color:"#C586C0"},children:"await"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})}),s.jsx(l.div,{className:"line"}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"foo"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"() {"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#6A9955"},children:"    // spans of joined futures will be siblings in the tree"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"join"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"bar"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"3"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:")."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"instrument_await"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#CE9178"},children:'"bar"'}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"),"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"        "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"baz"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"2"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:")."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"instrument_await"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#CE9178"},children:'"baz"'}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"),"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    )"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    ."}),s.jsx(l.span,{style:{color:"#C586C0"},children:"await"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:";"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})}),s.jsx(l.div,{className:"line"}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"#[tokio::main]"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#569CD6"},children:"async"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"fn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"main"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"() {"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"registry"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Registry"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"new"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Config"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"default"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"());"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"root"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"registry"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"register"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"((), "}),s.jsx(l.span,{style:{color:"#CE9178"},children:'"foo"'}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:");"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"tokio"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"spawn"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"root"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"instrument"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"foo"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"()));"})]}),s.jsx(l.div,{className:"line"}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"sleep"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#4EC9B0"},children:"Duration"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"::"}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"from_secs"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#B5CEA8"},children:"1"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"))."}),s.jsx(l.span,{style:{color:"#C586C0"},children:"await"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:";"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#569CD6"},children:"let"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"tree"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" = "}),s.jsx(l.span,{style:{color:"#9CDCFE"},children:"registry"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"get"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"(())."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"unwrap"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"()."}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"to_string"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"();"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    "}),s.jsx(l.span,{style:{color:"#DCDCAA"},children:"println!"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:"("}),s.jsx(l.span,{style:{color:"#CE9178"},children:'"{tree}"'}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:");"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"}"})}),s.jsx(l.div,{className:"line"})]})})]}),`
`,s.jsxs(l.pre,{className:"shiki dark-plus",style:{backgroundColor:"#1E1E1E",color:"#D4D4D4"},children:[s.jsx(l.div,{className:"language-id",children:"bash"}),s.jsx(l.div,{className:"code-container",children:s.jsxs(l.code,{children:[s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"foo [1.003s]"})}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"  bar [1.003s]"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    baz "}),s.jsx(l.span,{style:{color:"#C586C0"},children:"in"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" bar [1.003s]"})]}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"      pending "}),s.jsx(l.span,{style:{color:"#C586C0"},children:"in"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" baz 3 [1.003s]"})]}),s.jsx(l.div,{className:"line",children:s.jsx(l.span,{style:{color:"#D4D4D4"},children:"  baz [1.003s]"})}),s.jsxs(l.div,{className:"line",children:[s.jsx(l.span,{style:{color:"#D4D4D4"},children:"    pending "}),s.jsx(l.span,{style:{color:"#C586C0"},children:"in"}),s.jsx(l.span,{style:{color:"#D4D4D4"},children:" baz 2 [1.003s]"})]})]})})]}),`
`,s.jsxs(l.h3,{id:"openharmony",children:["openharmony",s.jsx(l.a,{className:"header-anchor",href:"#openharmony",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsxs(l.h4,{id:"诉求",children:["诉求",s.jsx(l.a,{className:"header-anchor",href:"#诉求",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsxs(l.ul,{children:[`
`,s.jsx(l.li,{children:"可以检测任务阻塞和执行时间过长"}),`
`,s.jsx(l.li,{children:"支持黑匣打印"}),`
`,s.jsx(l.li,{children:"支持性能调优"}),`
`,s.jsx(l.li,{children:"可以推出完整的异步栈"}),`
`,s.jsx(l.li,{children:"运行态避免额外性能 & 内存开销"}),`
`,s.jsx(l.li,{children:"易用性，避免大范围的侵入式修改"}),`
`]}),`
`,s.jsxs(l.h4,{id:"yinglong-框架",children:["yinglong 框架",s.jsx(l.a,{className:"header-anchor",href:"#yinglong-框架",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsx(l.p,{children:s.jsx(l.img,{src:"https://images.felixwliu.cn/rust01.png",alt:"yinglong"})}),`
`,s.jsxs(l.ul,{children:[`
`,s.jsxs(l.li,{children:[`pending 状态
`,s.jsx(l.img,{src:"https://images.felixwliu.cn/rust02.png",alt:"yinglong"})]}),`
`,s.jsxs(l.li,{children:[`组合
`,s.jsx(l.img,{src:"https://images.felixwliu.cn/rust03.png",alt:"yinglong"})]}),`
`,s.jsxs(l.li,{children:[`任务栈
`,s.jsx(l.img,{src:"https://images.felixwliu.cn/rust04.png",alt:"yinglong"})]}),`
`,s.jsxs(l.li,{children:[`组合信息
`,s.jsx(l.img,{src:"https://images.felixwliu.cn/rust05.png",alt:"yinglong"})]}),`
`]}),`
`,s.jsxs(l.h2,{id:"其他",children:["其他",s.jsx(l.a,{className:"header-anchor",href:"#其他",children:s.jsx(l.span,{className:"icon icon-link"})})]}),`
`,s.jsx(l.p,{children:s.jsx(l.a,{href:"https://blog.hpp2334.com/blog/reactor-pattern",children:"reactor"})})]})}function i(e={}){const{wrapper:l}={...c(),...e.components};return l?s.jsx(l,{...e,children:s.jsx(n,{...e})}):n(e)}export{i as default};
